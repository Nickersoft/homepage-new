---
import type { CollectionEntry } from "astro:content";

import OpenInNew from "~icons/mdi/open-in-new";

import FormattedDate from "../components/FormattedDate.astro";
import BaseLayout from "./BaseLayout.astro";
import Button from "../components/Button.astro";
import Back from "~icons/mdi/arrow-left";
import Tweet from "~icons/mdi/twitter";

type Props = CollectionEntry<"blog">["data"];

const { title, original, description, pubDate, updatedDate } = Astro.props;

function getShareURL() {
  const url = Astro.url.toString();
  const tweet = `An absolutely lovely read by @tylernickerson: ${url}`;
  return `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweet)}`;
}
---

<BaseLayout>
  <article class="article">
    <nav class="mb-8 flex w-full justify-between items-center flex-row">
      <Button variant="secondary" title="Back" href="/" icon={Back} />
      <a href="/" class="hover:opacity-100 transition-all duration-150 opacity-50 flex-grow text-center">Tyler Nickerson</a>
      <Button variant="secondary" href={getShareURL()} title="Share" icon={Tweet} />
    </nav>

    <h1 class="title">{title}</h1>

    <p class="description">{description}</p>
    <!-- {
      heroImage && (
        <img class="hero" width={720} height={360} src={heroImage} alt="" />
      )
    } -->
    <FormattedDate date={pubDate} />

    <hr />

    {
      updatedDate && (
        <div class="last-updated-on">
          Last updated on <FormattedDate date={updatedDate} />
        </div>
      )
    }

    <div
      class="prose dark:prose-invert prose-blockquote:font-normal prose-figcaption:mt-6 prose-base prose-p:leading-loose w-full !max-w-full prose-headings:font-sans prose-figure:text-center prose-img:mx-auto content"
    >
      <slot />
      <hr />
      {
        original && (
          <div class="notice">
            This article was originally published on{" "}
            <a
              class="inline-flex gap-0.5 flex-row justify-center items-center"
              href={original}
              target="_blank"
              rel="noreferrer noopener"
            >
              {new URL(original).hostname}
              <OpenInNew class="w-3 h-3" />
            </a>{" "}
            and has been posted above for convenience.
          </div>
        )
      }
    </div>
  </article>
</BaseLayout>

<style lang="postcss" is:global>
  .prose img:not(.unstyled) {
    @apply rounded-md shadow-md border border-white border-opacity-5;
  }

  .prose .unstyled img {
    @apply rounded-none shadow-none border-none !important;
  }
</style>

<style lang="postcss">
  .article {
    @apply flex flex-col items-center;
  }

  hr {
    @apply w-full border-black dark:border-white opacity-10 my-8 !important;
  }

  .description {
    @apply text-lg font-sans opacity-75 mb-8;
  }

  .notice {
    @apply dark:text-white text-opacity-50 text-center text-sm text-black;
  }

  .hero {
    @apply rounded-md;
  }

  .title {
    @apply text-4xl font-sans font-bold text-center leading-normal;
    @apply w-full py-2;  
  }
  </style>
